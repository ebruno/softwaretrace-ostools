# FreeBSD runners #

## FreeBSD Runner on vCenter ##

Variables:

 | Name                     | Description  | Type | Default | Required | Adjust for deployment environment |
 |:-------------------------|:-------------|:-----|:--------|:--------:|:--------------------:|
 | adminuser                | Admin User acccount to set in the VM. | string | packer | Yes | optional |
 | adminuser\_password      | Password to set in the VM for adminuser. | string | packer | Yes | optional |
 | adminuser\_password\_enc | Encrypted Password (must match adminuser_password to set in the VM for adminuser. | string | ecrypted string representing "packer" | Yes | optional |
 | convert\_to\_template    | Convert the virtual machine to a template after the build is complete. If set to true, the virtual machine can not be imported into a content library | bool | true | Yes | Yes |
 | datacenter               | vCenter datacenter to install VM | string | None | Yes | Yes |
 | esxi\_server             | esxi server IP/FQDN | string | None | Yes | Yes |
 | hostname                 | Hostname to use for the system. | string | None | Yes | Yes |
 | install\_ssh\_key        | Indicates if the systems unique ssh should be installed for the default following users | string | None | Yes | Yes |
 | iso\_checksum            | Check sum for iso file | string | None | Yes | Yes |
 | iso\_url                 | URL for iso file | string | None | Yes | Yes |
 | output\_directory        | Output directory for VM artifacts |string | ./output-artifacts | Yes | Yes |
 | public\_key              | Public key for ssh login | string | None | Yes | Yes |
 | remote\_password         | User password for login | string | None | Yes | Yes |
 | remote\_username         | User name for login | string  | None  | Yes | Yes |
 | root\_password\_enc      | VM's root password for login  | string | encypted string for the password 'packer' | Yes | Yes |
 | ssh\_password            | Plain text to for the ssh connection | string | packer | Yes | Yes |
 | ssh\_password\_enc       | User name to for the ssh connection | string | packer | Yes | Yes |
 | ssh\_private\_key\_file  | Private key for to allow login via ssh" | string | autogenerated by create\_autolinux.sh | Yes | Yes |
 | ssh\_user                | User name to for the ssh connection | string | packer | Yes | Yes |
 | vcenter\_datastore       | vCenter datastore to install VM | string | None | Yes | Yes |
 | vcenter\_server          | vCenter Server IP/FQDN | string | None | Yes | Yes |
 | vm\_name                 | Virtual Machine name to build  | string | Fedorasrv42\_Demo | Yes | Yes |

Note: It is necessary to create pkvar.hcl files or pass variables on the command line
to provide login and other information which does not have default.


### How to create the OVA ###
Use the convinence script create_freebsd.sh.

 * The script is currently configured to create freeBSD 14.3 to use.
 * Generate a unique private key to use.
 * Create the VM and export the vSphere template and disk.

 The script will accept an variable filename on the command if one is not provided on the command line it will
 look for vcenter.pkvars.hcl.

	   ./create_freebsd.sh [ pkvar file name ]

Use the cleanup.sh script to remove build artifacts when done.

## FreeBSD Runner on libvirt ##

Variables:

 | Name                     | Description  | Type | Default | Required | Adjust for deployment environment |
 |:-------------------------|:-------------|:-----|:--------|:--------:|:--------------------:|
 | adminuser                | Admin User acccount to set in the VM. | string | packer | Yes | optional |
 | adminuser\_password      | Password to set in the VM for adminuser. | string | packer | Yes | optional |
 | adminuser\_password\_enc | Encrypted Password (must match adminuser_password to set in the VM for adminuser. | string | ecrypted string representing "packer" | Yes | optional |
 | convert\_to\_template    | Convert the virtual machine to a template after the build is complete. If set to true, the virtual machine can not be imported into a content library | bool | true | Yes | Yes |
 | datacenter               | vCenter datacenter to install VM | string | None | Yes | Yes |
 | efi\_firmware\_code      | The location and name of this may vary accross operating systems, see table below. | string | /usr/share/OVMF/OVMF_CODE_4M.fd | Yes | Yes |
 | efi\_firmware\_vars      | The location and name of this may vary accross operating systems, see table below. | string | /usr/share/OVMF/OVMF_VARS_4M.fd | Yes | Yes |
 | esxi\_server             | esxi server IP/FQDN | string | None | Yes | Yes |
 | hostname                 | Hostname to use for the system. | string | None | Yes | Yes |
 | install\_ssh\_key        | Indicates if the systems unique ssh should be installed for the default following users | string | None | Yes | Yes |
 | iso\_checksum            | Check sum for iso file | string | None | Yes | Yes |
 | iso\_url                 | URL for iso file | string | None | Yes | Yes |
 | libvirt\_group           | Name of the group of the images directory | string | libvirt | Yes | Yes |
 | libvirt\_nvram_dir       | Name of the group of the images directory | string | libvirt | Yes | Yes |
 | libvirt\_owner           | Name of the owner of the nvram images directory | string | libvirt | Yes | Yes |
 | libvirt\_vm\_image_dir   | Location for virtural machine images in your environment | string | /var/lib/libvirt/images | Yes | Yes |
 | nvram\_group             | Name of the group of the images directory | string | libvirt | Yes | Yes |
 | nvram\_owner             | Name of the owner of the images directory | string | root    | Yes | Yes |
 | output\_directory        | Output directory for VM artifacts |string | ./output-artifacts | Yes | Yes |
 | public\_key              | Public key for ssh login | string | None | Yes | Yes |
 | qemu\_binary |           | The name of the Qemu binary to look for. This defaults to qemu-system-x86_64, but may need to be changed for some platforms. For example qemu-kvm on RHEL 8, 9 and 10. | string | qemu-system-x86_64 | Yes | Yes |
 | root\_passwd             | VM's root password for login  | string | string for the password 'packer' | Yes | Yes |
 | root\_password\_enc      | VM's root password for login  | string | encypted string for the password 'packer' | Yes | Yes |
 | ssh\_password            | Plain text to for the ssh connection | string | packer | Yes | Yes |
 | ssh\_password\_enc       | User name to for the ssh connection | string | packer | Yes | Yes |
 | ssh\_private\_key\_file  | Private key for to allow login via ssh" | string | autogenerated by create\_autolinux.sh | Yes | Yes |
 | ssh\_user                | User name to for the ssh connection | string | packer | Yes | Yes |
 | vm\_name                 | Virtual Machine name to build  | string | Fedorasrv42\_Demo | Yes | Yes |

Note: It is necessary to create pkvar.hcl files or pass variables on the command line
to provide login and other information which does not have default.

EFI Firmware locations:

| Operating System | Code                              | Firmware                            |
|:-----------------|:----------------------------------|:------------------------------------|
| debian           | /usr/share/OVMF/OVMF_CODE_4M.fd   | /usr/share/OVMF/OVMF_VARS_4M.fd     |
| ubuntu           | /usr/share/OVMF/OVMF_CODE_4M.fd   |  /usr/share/OVMF/OVMF_VARS_4M.fd    |
| fedora           | /usr/share/edk2/ovmf/OVMF_CODE.fd | /usr/share/edk2/ovmf/OVMF_VARS.fd   |
| rhel             | /usr/share/edk2/ovmf/OVMF_CODE.fd | /usr/share/edk2/ovmf/OVMF_VARS.fd   |

## File Inventory ##

   * files scripts that build the vm.
   * http files access via http this is currently a placeholder.
   * Packer template: freebsd_qcow2.pkr.hcl

## System Configuration ##

The packer build for freebsd requires the use of bridged interface.
Make sure the bridged interface is defined in /etc/qemu/bridge.conf for example:

	sudo cat /etc/qemu/bridge.conf
	allow virbr0
	allow bridge0

### How to create the QCOW2 image ###
Use the convinence script create_freebsd.sh.

 * The script is currently configured to create freeBSD 14.3 to use.
 * Generate a unique private key to use.
 * Create the VM and export the vSphere template and disk.

 The script will accept an variable filename on the command if one is not provided on the command line it will
 look for vcenter.pkvars.hcl.

	   ./create_freebsd_qcow2.sh [ pkvar file name ]

Use the cleanup.sh script to remove build artifacts when done.
